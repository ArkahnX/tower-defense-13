/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js*/

(function(t,n){function at(e,t){var n;if(Array.isArray(e))for(n=0;n<e.length;n++)t.call(e[n],n);else for(n in e)t.call(e[n],n)}function ft(e,t,n,r){return"rgba("+e+","+t+","+n+","+(r||1)+")"}function lt(e,t){s[H]=e,s[B]=t,o.clearRect(0,0,e,t)}function ct(e,t,n,r){var i,s=Object.create(null);for(var o in e)t&&n?(i=t.indexOf(o),i>-1?s[o]=n[i](e,o,r):s[o]=e[o]):s[o]=e[o];return s}function ht(e){return e-50<0?0:e-50}function pt(e){if(e)return e[v.x][v.y]}function dt(e,t){e.health-=t}function vt(e){return ot[$].round(e)}function mt(e){return ot[$][V](e)}function gt(e,t){return vt(e*h+ut-t)}function yt(e,t){return vt(e*h+ut-t/2)}function bt(e,t){return mt(ot[$].random()*(t-e+1))+e}function wt(){var e=0;for(var t=0;t<L[X];t++)e+=L[t].priority;var n=bt(0,e-1);for(var t=0;t<L[X];t++){if(n<L[t].priority)return t;n-=L[t].priority}return!1}function Et(e,t,n){var r=[];for(var i in e)e[i][t]===n&&r[J](e[i]);return r.length?r:!1}function St(e,t){var n=e%t;return(e-n)/t}function xt(e,t){return Math.random()*(t-e)+e}function Tt(e,t,n){return{"red":e,"green":t,"blue":n}}function Nt(e,t,n){return n?2*e*t+2*t*n+2*e*n:e*t}function Ct(){s=r[U]("canvas"),s[H]=l*h,s[B]=c*h,o=s.getContext("2d"),E.push(function(e,t){o.drawImage(e.image,yt(e.x,h),yt(e.y,h))}),S.push(function(e,t){t!==0&&(o.drawImage(t.image,yt(t.x,t.width),gt(t.y,t.height)),t.weapon.name&&Qn(t))}),x.push(function(){Wn(),On(),Dn(),Xt(),Kn(),Vt(),Vn(),f++,y--;if(!k[0].length&&!k[1])console.log("victory"),Fn();else if(k[0].length&&f===120){f=0;for(var e=0;e<vt(m/2);e++)It()}else if(f===600||w)w=!1,k[1]||r[U]("nextWave").setAttribute("disabled",!0),m++,k.splice(0,1),g=k[0].length,y=g*120+600,f=0}),designWeapon("cannon",1,15,1,10,5,50,3,Tt(bt(200,255),bt(0,100),bt(0,100)),function(e){return e}),designWeapon("spread",5,20,1,50,4,25,3,Tt(bt(0,100),bt(0,100),bt(100,255)),function(e){return xt(e-e/2,e+e/2)}),designWeapon("gatling",1,20,1,0,5,100,3,Tt(bt(0,100),bt(100,255),bt(0,100)),function(e){return xt(e-e/2,e+e/2)}),designWeapon("explode",25,120,5,50,5.5,35,3,Tt(bt(0,100),bt(100,255),bt(100,255)),function(e){return xt(-2,2)/60}),C[J](Gt("Base","none","special",1e6,1e3,[[10,15],[20,30],[10,15]],[Tt(225,0,0),Tt(ht(225),0,0)])),C[J](Gt("Cannon","cannon","basic",50,10,[[10,15],[10,15],[5,10]],[Tt(200,0,0),Tt(ht(200),0,0)])),C[J](Gt("Shotgun","spread","basic",250,10,[[15,20],[15,20],[10,15]],[Tt(125,0,0),Tt(ht(125),ht(125),0)])),C[J](Gt("Explode","explode","basic",500,10,[[20,25],[20,25],[15,20]],[Tt(125,0,0),Tt(0,ht(125),ht(125))])),C[J](Gt("Gatling","gatling","basic",1e3,10,[[25,30],[25,30],[20,25]],[Tt(125,0,0),Tt(0,0,125)])),L.push(kt("grass",et,7,1,At([[1024,175,230,1.3,1,2],[50,200,245,1,1.3,1.5],[100,125,175,2,1,2]]))),L.push(kt("darkGrass",et,7,1,At([[1024,150,205,1.3,1,2],[50,175,220,1,1.3,1.5],[100,100,150,2,1,2]]))),L.push(kt("road","fast",4,.5,At([[1024,0,0,1,1,1],[600,0,50,1,1,1]]))),L.push(kt("water","slow",3,1.5,At([[1024,100,200,1.5,1.5,1],[600,100,200,1.5,1.5,1]]))),jt(10),qt(13),g=k[0].length,y=g*120+600}function kt(e,t,n,r,i){var u=[];lt(32,32);var a=3;for(var f=0;f<a;f++){var d=bt(i[0].fromColor,i[0].toColor);o.fillStyle=ft(vt(d/i[0].redFactor),vt(d/i[0].greenFactor),vt(d/i[0].blueFactor)),o.fillRect(0,0,h,h);for(var v=0;v<i[X];v++)Lt(i[v]);var m=new Image;m[tt]=s[G](),u[J](m),lt(l*h,c*h)}var g=p;return p++,s[H]=l*h,s[B]=c*h,{"name":e,"is":"terrain","type":t,"x":0,"y":0,"image":u,"images":u[X],"priority":n,"id":g,"speed":r}}function Lt(e){var t,n,r=0,i=0;for(t=0;t<e.pixels;t++)r=bt(0,h-1),i=bt(0,h-1),n=bt(e.fromColor,e.toColor),o.fillStyle=ft(vt(n/e.redFactor),vt(n/e.greenFactor),vt(n/e.blueFactor)),o.fillRect(r,i,1,1)}function At(e){var t=[];for(var n=0;n<e.length;n++)t.push({"pixels":e[n][0],"fromColor":e[n][1],"toColor":e[n][2],"redFactor":e[n][3],"greenFactor":e[n][4],"blueFactor":e[n][5]});return t}function Ot(e,t,n){return e[t][bt(0,e.images-1)]}function Mt(e,t,n){return n[0]}function _t(e,t,n){return n[1]}function Dt(e,t){for(var n=0;n<e;n++){T[n]=T[n]||[],N[n]=N[n]||[];for(var r=0;r<t;r++){var i=wt(),s=ct(L[i],["image","x","y"],[Ot,Mt,_t],[n,r]);T[n][r]=s,N[n][r]=0}}a=ct(C[0]),a.x=bt(e/2-1,t/2+1),a.y=bt(e/2-1,t/2+1),N[a.x][a.y]=a}function Pt(){var e,t,n,r;for(e=0;e<T[X];e++)for(t=0;t<T[e][X];t++)for(n=0;n<E[X];n++)E[n](T[e][t],N[e][t]);for(e=0;e<T[X];e++)for(t=0;t<T[e][X];t++)for(n=0;n<S[X];n++)S[n](T[e][t],N[e][t]);for(r=0;r<x[X];r++)x[r]()}function Ht(e,t){var r=[];for(var i=0;i<T.length;i++){r[i]=r[i]||[];for(var s=0;s<T[i].length;s++){var o=ct(L[T[i][s].id],["image","x","y"],[Ot,Mt,_t],[i,s]);N[i][s]&&N[i][s][P].toLowerCase()!=="base"&&(o.speed=0),r[i][s]=o}}return e!==n&&t!==n&&(r[e][t]=ct(L[r[e][t].id],["image","x","y"],[Ot,Mt,_t],[e,t]),r[e][t].speed=0),r}function Bt(e){var t=[];for(var n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)if(n===0||n===e.length-1||r===0||r===e[n].length-1)if(e[n][r].speed!==0&&a){var i=gn.search(e,e[n][r],e[a.x][a.y]);i.length&&t.push(!0)}else t.push(!1);return t}function jt(e){for(var t=1;t<e+1;t++){var n=t/2,r=7;n*2>r&&(r=n*2),A.push({"level":t,"size":r,"speed":n*.5,"health":t*10,"fullHealth":n*10,"targetX":null,"targetY":null,"path":null,"x":null,"y":null,"pixelX":null,"pixelY":null,"pathIndex":0,"color":"rgb(0,0,0)","red":0,"green":0,"blue":0})}}function Ft(e){var t,n=0;do{do{var r=0,i=0;if(side===0||side===2)r=bt(0,l-1),side===2&&(i=l-1);else if(side===1||side===3)i=bt(0,c-1),side===1&&(r=c-1);n++;var s=Ht()}while(s[r][i].speed===0);data.x=r,data.y=i,data.pixelX=yt(r,data.size),data.pixelY=yt(i,data.size),t=Jt([data],s)}while(!t.length);return data.path=t,data.targetX=t[0].x,data.targetY=t[0].y,data.pathIndex=0,e}function It(){if(k[0]&&a){var e=k[0].splice(0,1)[0],t,n=0;do{do{var r=bt(0,3),i=0,s=0;if(r===0||r===2)i=bt(0,l-1),r===2&&(s=l-1);else if(r===1||r===3)s=bt(0,c-1),r===1&&(i=c-1);n++;var o=Ht()}while(o[i][s].speed===0);e.x=i,e.y=s,e.pixelX=yt(i,e.size),e.pixelY=yt(s,e.size),t=Jt([e],o)}while(!t.length);e.path=t,e.targetX=t[0].x,e.targetY=t[0].y,e.pathIndex=0,O.push(e)}}function qt(e){for(var t=1;t<e+1;t++){var n=[],r=0;for(var i=t;i>0;i--){for(var s=0;s<i*2;s++){var o=ct(A[r]);n.push(o)}r=vt(t/e*(A.length-1))}k.push(n)}}function Rt(e,t,n){return n[0]}function Ut(e,t,n){return n[1]}function zt(e,t,n){return yt(n[0],e.size)}function Wt(e,t,n){return yt(n[1],e.size)}function Xt(){at(O,function(e){var t=this;t.health<1?$t(t,e):(o.beginPath(),o.strokeStyle="white",o.lineWidth=2,o.strokeRect(t.pixelX,t.pixelY,t.size,t.size),o.fillStyle=t.color,o.fillRect(t.pixelX,t.pixelY,t.size,t.size),o.fill(),o.closePath())})}function Vt(){at(O,function(e){var t=this;if(a&&t.pathIndex<t[et][X]){var n=t[et][t.pathIndex];t.x=St(t.pixelX+t.size/2,h),t.y=St(t.pixelY+t.size/2,h),t.targetX=n.x,t.targetY=n.y;var r=T[t.x][t.y],i=t[st]/r[st],s=yt(t.targetX,t.size),o=yt(t.targetY,t.size);vt(t.pixelX)<s?t.pixelX+i>s?t.pixelX=s:t.pixelX+=i:vt(t.pixelY)<o?t.pixelY+i>o?t.pixelY=o:t.pixelY+=i:vt(t.pixelX)>s?t.pixelX-i<s?t.pixelX=s:t.pixelX-=i:vt(t.pixelY)>o&&(t.pixelY-i<o?t.pixelY=o:t.pixelY-=i),vt(t.pixelX)===yt(t.targetX,t.size)&&vt(t.pixelY)===yt(t.targetY,t.size)&&t.pathIndex++}a&&t.x===a.x&&t.y===a.y&&(on(t),$t(t,e))})}function $t(e,t){var n=e.pixelX,r=e.pixelY,i=e.size/2;$n(mt(e.health/e.fullHealth*e.size)+1,60,[2,7],[-2,2,-2,2],[n,r-i,n+i,r+i],[ft(e.red,e.green,e.blue),ft(ht(e.red),ht(e.green),ht(e.blue))]),qn(e.fullHealth*10/(m/2)),O.splice(t,1)}function Jt(e,t){if(a){var n=[],r,i,s;return at(e,function(e){i=this,s=t||Ht(),r=gn.search(s,s[i.x][i.y],s[a.x][a.y]),n[J](!!r.length)}),n.indexOf(!1)>-1?!1:r}}function Kt(e){at(e,function(e){var t=this,n=Jt([t]);t.path=n,t.pathIndex=0,t.targetX=n[0].x,t.targetY=n[0].y})}function Qt(){if(!k[1])r[U]("nextWave").setAttribute("disabled",!0),_n(r.getElementById("nextWave"),"click",Qt);else{w=!0;for(var e=0;e<k[0].length;e++)k[1].push(k[0][e])}}function Gt(e,t,n,r,i,s,o){var u=Yt(t,s,o);return{"is":"tower","name":e,"weapon":t,"width":u.width,"height":u.height,"depth":u.depth,"path":u.path,"colors":u.colors,"image":Zt(u),"x":u.x,"y":u.y,"level":1,"type":n,"cost":r,"health":i,"fullHealth":i}}function Yt(e,t,n){var r=bt(t[0][0],t[0][1]),i=bt(t[1][0],t[1][1]),s=bt(t[2][0],t[2][1]),o="rectangle";return e!=="none"&&(o="triangle"),{"x":0,"y":0,"width":r,"height":i,"depth":s,"colors":n,"path":o}}function Zt(e){var t=s[H],n=s[B];lt(e.width,e.height+e.depth),nn[e.path](e);var r=new Image;return r[tt]=s[G](),lt(t,n),r}function en(e,t,n,r,i,s){o.beginPath(),o.rect(e,t,n,r),o.fillStyle=i,o.fill(),o.closePath()}function tn(e,t,n,r,i,s,u){o.beginPath(),o.moveTo(e,t),o.lineTo(i,s),o.lineTo(n,r),o.closePath(),o.fillStyle=u,o.fill(),o.closePath()}function rn(){if(a!==null)return a;if(a===null){var e=sn();if(e)return a=N[e.x][e.y],a}return!1}function sn(){for(var e=0;e<N[X];e++)for(var t=0;t<N[e][X];t++)if(N[e][t][P]==="base")return{"x":e,"y":t};return!1}function on(e){Rn(e.health),dt(a,e.health);if(a.health<1){un(a.x,a.y),a=null;var t=rn();t||(console.log("defeat"),Fn())}}function un(e,t){var n=N[e][t],r=yt(t,h),i=r-n.height/2,s=r+n.height,o=yt(e,h),u=o+ut-n.width/2,a=o+n.width,f=[];for(var l=0;l<n.colors.length;l++){var c=n.colors[l];f.push(ft(c.red,c.green,c.blue))}$n(20,50,[2,7],[-2,2,-2,2],[u,i,a,s],f,!0),N[e][t]=0}function an(e,t){var n=N[e][t];qn(n.cost*(n.health/n.fullHealth)*.75),un(e,t)}function fn(){var e=dn().cost;d=null,qn(e)}function ln(e,t,n){return ct(D[e.weapon])}function cn(e,t){if(hn()){var n=N[e][t];Rn(upgradeCost(n)),n.level++}}function hn(){return b&&In>upgradeCost(b)?!0:!1}function pn(){return dn()?!0:!1}function dn(){return d===Y?!1:Et(C,P,d)[0]}function vn(){r.body.style.cursor="default";if(pt(N)!==0)return r.body.style.cursor="pointer",Y;if(!pn())return!0;var e=Ht(v.x,v.y);if(Bt(e).indexOf(!0)===-1)return!1;if(O[X]){var t=Et(O,"x",v.x);if(Et(t,"y",v.y)[X])return!1;var t=Et(O,"targetX",v.x);if(Et(t,"targetY",v.y)[X])return!1;var e=Ht(v.x,v.y);if(!Jt(O,e))return!1}return dn().is==="terrain"?!0:pt(T).type===et?!0:dn().is==="trap"&&pt(T).type==="fast"?!0:!1}function mn(){r[U](Z).children[X]>0&&(r[U](Z)[R]="");var e=[];for(var t=0;t<C[X];t++){var n=C[t],i=j+">"+n[P]+q,s=j+" class='cost'>$"+n.cost+q,o="<img src='"+n.image.src+"'>",u=F+" class='container' title='"+n.is+": "+n[P]+" ($"+n.cost+")"+"'>"+o+i+s+I;e.push(""+u+"")}r[U](Z)[R]=e.join(""),xn()}function yn(e){this.content=[],this.scoreFunction=e}function bn(){wn(),u=requestAnimationFrame(bn)}function wn(){lt(l*h,c*h),Pt()}function En(){r[U]("loadingText")[Q].add("hidden"),r[U]("message")[Q].remove("hidden")}function Sn(){r[U]("loading")[Q].add("hidden"),bn()}function xn(){var e=r[W](".container");for(var t=0;t<e[X];t++)Mn(e[t],"click",Nn)}function Tn(e){e.preventDefault()}function Nn(e){Tn(e);var t=this;!t[Q].contains("expensive")&&!pn()&&(b=null,d=t[z]("span").innerText,Rn(Et(C,P,d)[0].cost))}function Cn(e){Tn(e),(a.x!==v.x||a.y!==v.y)&&an(b.x,b.y),b=null}function kn(e){console.log("clicked"),Tn(e),(a.x!==v.x||a.y!==v.y&&!r.getElementById("upgrade").classList.contains("expensive"))&&cn(b.x,b.y)}function Ln(e){Tn(e),b=null;if(pn()&&vn())if(e.which===2)fn();else{var t=ct(dn(),["x","y","weapon"],[Mt,_t,ln],[v.x,v.y]);N[v.x][v.y]=t,d=null,Un(),O.length&&Kt(O)}vn()===null&&(e.which===2?(a.x!==v.x||a.y!==v.y)&&an(v.x,v.y):b=N[v.x][v.y])}function An(e){v.x=e.pageX-s.offsetLeft,v.y=e.pageY-s.offsetTop,v.x=St(v.x,h),v.y=St(v.y,h)}function On(){strokeColor="black",vn()&&pn()?strokeColor="green":vn()===Y?strokeColor="blue":vn()||(strokeColor="red")}function Mn(e,t,n){_n(e,t,n),e.addEventListener(t,n,!0)}function _n(e,t,n){e.removeEventListener(t,n)}function Dn(){var e=v.x*32,t=v.y*32;o.strokeStyle=strokeColor,o.lineWidth=2,o.strokeRect(e,t,32,32),o.strokeStyle="#FFF",o.strokeRect(e-2,t-2,36,36)}function Pn(){Mn(r,"keydown",Hn)}function Hn(e){var t=0;e.keyCode-48>=1&&e.keyCode-48<=5?t=e.keyCode-48:e.keyCode-96>=1&&e.keyCode-96<=5&&(t=e.keyCode-96);if(t>0){Tn(e);var n=r[W](".container"),i=n[t-1];!i[Q].contains("expensive")&&!pn()&&(b=null,d=i[z]("span").innerText,Rn(Et(C,P,d)[0].cost))}}function Bn(){for(i=0;i<A[X];i++){var t=A[i];for(e=0;e<t.path.length;e++){var n=t.path[e];o.beginPath(),o.fillStyle="rgba(100,100,100,0.5)",o.fillRect(n.x*h,n.y*h,h,h),o.fill(),o.closePath()}}}function jn(){for(i=0;i<A[X];i++){var t=A[i],n=Ht(v.x,v.y),r=getBaseCoords(),s=gn.search(n,n[t.x][t.y],n[r.x][r.y]);for(e=0;e<s.length;e++){var u=s[e];o.beginPath(),o.fillStyle="rgba(0,255,0,0.5)",o.fillRect(u.x*h,u.y*h,h,h),o.fill(),o.closePath()}}}function Fn(){cancelAnimationFrame(u)}function qn(e){In+=vt(e),Un()}function Rn(e){In-=vt(e),Un()}function Un(){var e=r[W](".container");for(var t=0;t<e[X];t++){e[t][Q].remove("expensive"),e[t][Q].remove("building");var n=e[t][z](".cost").innerText.substring(1);parseInt(n,10)>In&&e[t][Q].add("expensive"),dn()&&e[t][Q].add("building")}zn()}function zn(){hn()?r.getElementById("upgrade").setAttribute("disabled",!0):r.getElementById("upgrade").removeAttribute("disabled")}function Wn(){var e=rn().health||0,t="<li>",n="</li>",i="<code>",s="</code>",o=[];o[J]("Base Health: "+i+e+s),o[J]("Wave: "+i+m+s),o[J]("Enemies: "+i+g+s),o[J]("Enemies Remaining: "+i+(k[0].length+O.length)+s),o[J]("Time until Next Wave: "+i+y+s),o[J]("money: "+i+In+s),r[U]("data")[R]="<ul>"+t+o.join(n+t)+n+"</ul>";var o=[];o[J]("Mouse Position: "+i+v.x+", "+v.y+s),o[J]("Tile: "+i+pt(T).name+s),o[J]("Can Build: "+i+vn()+s),r[U]("selection")[R]="<ul>"+t+o.join(n+t)+n+"</ul>";if(b!==null){var o=[];for(var u in b){var a=["is","width","height","depth","colors","image","x","y","path","type","weapon"];a.indexOf(u)===-1&&o.push(u+": "+i+b[u]+s)}r[U]("tower")[R]="<ul>"+t+o.join(n+t)+n+"</ul>",b.name!=="Base"&&(r[U]("sell").removeAttribute("disabled"),Mn(r[U]("sell"),"click",Cn),hn()?(r[U]("upgrade").removeAttribute("disabled"),Mn(r[U]("upgrade"),"click",kn)):(r[U]("upgrade").setAttribute("disabled",!0),_n(r[U]("upgrade"),"click",kn)))}else r[U]("tower")[R]="",r[U]("upgrade").setAttribute("disabled",!0),r[U]("sell").setAttribute("disabled",!0),_n(r[U]("sell"),"click",Cn),_n(r[U]("upgrade"),"click",kn)}function Xn(e,t,n,r,i,s,o,u,a,f,l,c){var p=i/3,d=h/60*bt(i+p,i-p),v=bt(0,c.length);return{"x":bt(e,n),"y":bt(t,r),"w":bt(s,o),"h":bt(s,o),"dx":xt(u,a),"dy":xt(f,l),"life":d,"lifespan":d,"color":c[v]}}function Vn(){for(var e=0;e<M.length;e++){var t=M[e];o.beginPath(),o.fillStyle=t.color,o.fillRect(t.x,t.y,t.w,t.h),o.fill(),o.closePath(),t.life=t.life-1,t.life>0?(t.x=t.x+t.dx,t.y=t.y+t.dy):M.splice(e,1)}}function $n(e,t,n,r,i,s){for(var o=0;o<e;o++)M.push(Xn(i[0],i[1],i[2],i[3],t,n[0],n[1],r[0],r[1],r[2],r[3],s))}function Jn(e){var t=0,n=e.length;waitForParticles}function Kn(){for(var e=0;e<_.length;e++){var t=_[e];if(t.x+t.radius>s.width||t.y+t.radius>s.height||t.x<0||t.y<0)_.splice(e,1);else{var n=Zn(t);if(n){_.splice(e,1),dt(n,t.damage);var r=n.pixelX,i=n.pixelY,u=n.size/2;$n(mt(t.damage/n.fullHealth*n.size)+1,60,[2,7],[-2,2,-2,2],[r,i-u,r+u,i+u],[ft(n.red,n.green,n.blue),ft(ht(n.red),ht(n.green),ht(n.blue))])}else{o.beginPath(),o.fillStyle="rgba("+t.red+","+t.green+","+t.blue+","+t.life/t.maxLife+")",o.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),o.fill(),o.closePath();if(t.life>0||t.life<0)t.targetX>0&&t.targetY>0?(t.x-=t.speed*t.dx,t.y-=t.speed*t.dy):t.targetX<0&&t.targetY>0?(t.x-=t.speed*t.dx,t.y-=t.speed*t.dy):(t.x+=t.speed*t.dx,t.y+=t.speed*t.dy),t.life--;t.life===0&&_.splice(e,1)}}}}function Qn(e){e.weapon.timer>=e.weapon.delay&&at(O,function(t){var n=this,r=yt(e.x,1),i=yt(e.y,1,e.size)-e.height,s=e.weapon.range*h;if(Gn(r,i,s,n.pixelX,n.pixelY,n.size/2)&&e.weapon.timer>=e.weapon.delay){e.weapon.timer=0;var o=r-n.pixelX,u=i-n.pixelY,a=Math.atan(o/u),f=e.weapon.speed/60*Math.sin(a),l=e.weapon.speed/60*Math.cos(a);fireWeapon(e,r,i,f,l,o,u)}}),e.weapon.timer++}function Gn(e,t,n,r,i,s){var o=e-r,u=t-i,a=n+s;return o*o+u*u<=a*a}function Yn(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){if(e==="cannon")_.push({"radius":i,"x":o,"y":u,"dx":a,"dy":f,"red":l,"green":c,"blue":h,"alpha":p,"life":r,"maxLife":r,"speed":s,"targetX":t,"targetY":n,"damage":d||1});else if(e==="spread")for(var v=0;v<5;v++){var l=bt(0,100),c=bt(0,100),h=bt(100,255);Yn("cannon",t,n,25,3,s,o,u,xt(a-a/2,a+a/2),xt(f-f/2,f+f/2),l,c,h,p,2)}else if(e==="beam")_.push({"radius":i,"x":o,"y":u,"dx":xt(a-a/2,a+a/2),"dy":xt(f-f/2,f+f/2),"red":l,"green":c,"blue":h,"alpha":p,"life":1e3,"maxLife":100,"speed":20,"targetX":t,"targetY":n,"damage":1});else if(e==="explode")for(var v=0;v<25;v++)_.push({"radius":i,"x":o,"y":u,"dx":xt(-2,2)/60,"dy":xt(-2,2)/60,"red":l,"green":c,"blue":h,"alpha":p,"life":35,"maxLife":35,"speed":120,"targetX":t,"targetY":n,"damage":5})}function Zn(e){for(var t=0;t<O.length;t++){var n=O[t];if(Gn(n.pixelX,n.pixelY,n.size/2,e.x,e.y,e.radius))return n}return!1}var r=t.document,s,o,u=null,a=null,f=0,l=20,c=20,h=32,p=0,d=null,v={"x":0,"y":0},m=1,g=0,y=0,b=null,w=!1,E=[],S=[],x=[],T=[],N=[],C=[],k=[],L=[],C=[],A=[],O=[],M=[],_=[],D={},P="name",H="width",B="height",j="<span",F="<div",I="</div>",q="</span>",R="innerHTML",U="getElementById",z="querySelector",W=z+"All",X="length",V="floor",$="Math",J="push",K="rgb(",Q="classList",G="toDataURL",Y=null,Z="towers",et="path",tt="src",nt="cost",rt="next",it="color",st="speed",ot=t,ut=h/2;ot.addEventListener("DOMContentLoaded",function(){Ct(),mn(),Dt(l,c),qn(500),Mn(s,"mousemove",An),Mn(s,"mousedown",Ln),Mn(s,"contextmenu",Tn),Mn(r.getElementById("startGame"),"click",Sn),Mn(r.getElementById("nextWave"),"click",Qt),En(),Pn()});var nn={"triangle":function(e){var t=e.x,n=e.y,r=e.depth,i=e.width,s=e.height,o=i/2,u=e.colors;tn(o+t,n,t,n+s,t+o,n+s+r,ft(u[0].red,u[0].green,u[0].blue)),tn(o+t-1,n,o+t-1,n+s+r,t+i,n+s,ft(u[1].red,u[1].green,u[1].blue))},"rectangle":function(e){var t=e.colors;en(e.x,e.y+e.depth/2,e.width,e.height,ft(t[0].red,t[0].green,t[0].blue)),en(e.x,e.y,e.width,e.depth,ft(t[1].red,t[1].green,t[1].blue))}},gn={"init":function(e){for(var t=0,n=e[X];t<n;t++)for(var r=0,i=e[t][X];r<i;r++){var s=e[t][r];s.f=0,s.g=0,s.h=0,s[nt]=s[st],s.visited=!1,s.closed=!1,s.parent=Y}},"heap":function(){return new yn(function(e){return e.f})},"search":function(e,t,n){gn.init(e),heuristic=gn.manhattan;var r=gn.heap();r[J](t);while(r.size()>0){var i=r.pop();if(i===n){var s=i,o=[];while(s.parent)o[J](s),s=s.parent;return o.reverse()}i.closed=!0;var u=gn.neighbors(e,i);for(var a=0,f=u[X];a<f;a++){var l=u[a];if(l.closed||l[st]===0)continue;var c=i.g+l[nt],h=l.visited;if(!h||c<l.g)l.visited=!0,l.parent=i,l.h=l.h||heuristic(l.x,l.y,n.x,n.y),l.g=c,l.f=l.g+l.h,h?r.rescoreElement(l):r[J](l)}}return[]},"manhattan":function(e,t,n,r){var i=ot[$].abs(n-e),s=ot[$].abs(r-t);return i+s},"neighbors":function(e,t){var n=[],r=t.x,i=t.y;return e[r-1]&&e[r-1][i]&&n[J](e[r-1][i]),e[r+1]&&e[r+1][i]&&n[J](e[r+1][i]),e[r]&&e[r][i-1]&&n[J](e[r][i-1]),e[r]&&e[r][i+1]&&n[J](e[r][i+1]),n}};yn.prototype={"push":function(e){this.content[J](e),this.sinkDown(this.content[X]-1)},"pop":function(){var e=this.content[0],t=this.content.pop();return this.content[X]>0&&(this.content[0]=t,this.bubbleUp(0)),e},"size":function(){return this.content[X]},"rescoreElement":function(e){this.sinkDown(this.content.indexOf(e))},"sinkDown":function(e){var t=this.content[e];while(e>0){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},"bubbleUp":function(e){var t=this.content[X],n=this.content[e],r=this.scoreFunction(n);for(;;){var i=e+1<<1,s=i-1,o=Y;if(s<t){var u=this.content[s],a=this.scoreFunction(u);a<r&&(o=s)}if(i<t){var f=this.content[i],l=this.scoreFunction(f);l<(o===Y?r:a)&&(o=i)}if(o===Y)break;this.content[e]=this.content[o],this.content[o]=n,e=o}}};var In=0;(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t[X]&&!ot.requestAnimationFrame;++n)ot.requestAnimationFrame=ot[t[n]+"RequestAnimationFrame"],ot.cancelAnimationFrame=ot[t[n]+"CancelAnimationFrame"]||ot[t[n]+"CancelRequestAnimationFrame"];ot.requestAnimationFrame||(ot.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=ot[$].max(0,16-(r-e)),s=ot.setTimeout(function(){t(r+i)},i);return e=r+i,s}),ot.cancelAnimationFrame||(ot.cancelAnimationFrame=function(e){clearTimeout(e)})})(),typeof r!="undefined"&&!("classList"in r.createElement("a"))&&function(e){"use strict";var t="classList",n="prototype",r=(e.HTMLElement||e.Element)[n],i=Object,s=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array[n].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(t in this&&this[t]===e)return t;return-1},u=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(t==="")throw new u("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new u("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},f=function(e){var t=s.call(e.className),n=t?t.split(/\s+/):[],r=0,i=n.length;for(;r<i;r++)this.push(n[r]);this._updateClassName=function(){e.className=this.toString()}},l=f[n]=[],c=function(){return new f(this)};u[n]=Error[n],l.item=function(e){return this[e]||null},l.contains=function(e){return e+="",a(this,e)!==-1},l.add=function(e){e+="",a(this,e)===-1&&(this.push(e),this._updateClassName())},l.remove=function(e){e+="";var t=a(this,e);t!==-1&&(this.splice(t,1),this._updateClassName())},l.toggle=function(e){e+="",a(this,e)===-1?this.add(e):this.remove(e)},l.toString=function(){return this.join(" ")};if(i.defineProperty){var h={"get":c,"enumerable":!0,"configurable":!0};try{i.defineProperty(r,t,h)}catch(p){p.number===-2146823252&&(h.enumerable=!1,i.defineProperty(r,t,h))}}else i[n].__defineGetter__&&r.__defineGetter__(t,c)}(self)})(window)