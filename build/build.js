(function(e,t){function M(e,t,n){var r=[];for(var i in e)e[i][t]===n&&r[y](e[i]);return r}function _(e,t){return Bt(O[g].random()*(t-e+1))+e}function D(){q=n[h]("canvas"),q[s]=B*F,q[o]=j*F,R=q.getContext("2d")}function P(){var e=0;for(var t=0;t<Q[v];t++)e+=Q[t].priority;var n=_(0,e-1);for(var t=0;t<Q[v];t++){if(n<Q[t].priority)return t;n-=Q[t].priority}return!1}function H(e,t){var n=e%t;return(e-n)/t}function Z(){var e=n[d](".container");for(var t=0;t<e[v];t++)rt(e[t],"click",et)}function et(e){var t=this;t[w].contains("expensive")||(whatToBuild=t.find("img").attr("src"),console.log("remove"),Ut(buildList[whatToBuild].stats[C]))}function tt(e){}function nt(e){z.x=e.pageX-q.offsetLeft,z.y=e.pageY-q.offsetTop,z.x=H(z.x,F),z.y=H(z.y,F),W="black",ft()&&ut()?W="green":ft()===S?W="blue":ft()||(W="red")}function rt(e,t,n){it(e,t,n),e.addEventListener(t,n,!0)}function it(e,t,n){e.removeEventListener(t,n)}function st(){var e=z.x*32,t=z.y*32,n=e+32,r=t+32;R.strokeStyle=W,R.lineWidth=2,R.strokeRect(e,t,32,32),R.strokeStyle="#FFF",R.strokeRect(e-2,t-2,36,36)}function ot(){var e=["money"],t="<li>",r="</li>",i="<code>",s="</code>",o=[];for(var u=0;u<e[v];u++)typeof this[e[u]]=="function"?o[y](e[u]+": "+i+JSON.stringify(this[e[u]]())+s):o[y](e[u]+": "+i+JSON.stringify(this[e[u]])+s);n[h]("data")[c]="<ul>"+t+o.join(r+t)+r+"</ul>"}function ut(){return at()?!0:!1}function at(){return V===S?!1:M(structures,r,V)}function ft(){var e=J[z.y][z.x];if(K[z.y][z.x]!==0)return S;var t=M(G,"y",z.y);return t[v]&&M(t,"x",z.x)[v]?!1:ut()?at().is==="terrain"?!0:e.is===T?!0:at().is==="trap"&&e.is==="fast"?!0:!1:!0}function lt(){n[h](x)[c]=""}function ct(){n[h](x).children[v]>0&&lt();var e=[];for(var t=0;t<Y[v];t++){var i=Y[t],s=u+">"+i[r]+l,o=u+" class='cost'>$"+i[C]+l,p="<img src='"+i.image[N]+"'>",d=a+" class='container' title='"+i.is+": "+i[r]+" ($"+i[C]+")"+"'>"+p+s+o+f;e[y](""+d+"")}n[h](x)[c]=e.join(""),Z()}function ht(){menu.children()[v]>0&&lt();for(var e in buildList){var t=buildList[e],n=$(a+" class='container'>"+f),i=$(u+">"+t[r]+l),s=$(u+" class='cost'>$"+t.stats[C]+l),o=new Image;n.append(o),n.append(i),n.append(s),o[N]=t[N],o.title=t.type+": "+t[r]+" ($"+t.stats[C]+")",menu.append(n),applyClicks()}var c=$("#canvas").position().left,h=$("#canvas").position().top;target.css({"left":c-3,"top":h-3})}function pt(e,t){for(var n=0;n<t;n++){J[n]=J[n]||[],K[n]=K[n]||[];for(var r=0;r<e;r++){var i=P(),s=Q[i];s.x=r,s.y=n,s.pos={"x":r,"y":n},J[n][r]=new yt(Q[i],"imageList"),K[n][r]=0}}var o=_(e/2-1,t/2+1);return K[o][o]=1,[J,K]}function dt(){for(var e=0;e<J[v];e++)for(var t=0;t<J[e][v];t++)R.drawImage(J[e][t].image,t*32,e*32)}function vt(){for(var e=0;e<J[v];e++)for(var t=0;t<J[e][v];t++)K[e][t]>0&&Nt(Y[K[e][t]-1][r],t,e)}function mt(e,t,n,r,i,s,o){var u,a,f=[],l=[];for(var c=0;c<e;c++)f[y](_(0,t-1,e)),l[y](_(0,t-1,e));for(u=0;u<e;u++)a=_(n,r),R.fillStyle=b+Bt(a/i)+","+Bt(a/s)+","+Bt(a/o)+")",R.fillRect(f[u],l[u],1,1)}function gt(e,t,n,r,i,u){var a=[];q[s]=32,q[o]=32;for(var f=0;f<3;f++){num=_(i[0][1],i[0][2]),R.fillStyle=b+Bt(num/i[0][3])+","+Bt(num/i[0][4])+","+Bt(num/i[0][5])+")",R.fillRect(0,0,u,u);for(var l=0;l<i[v];l++)mt(i[l][0],u,i[l][1],i[l][2],i[l][3],i[l][4],i[l][5]);var c=new Image;c[N]=q[E](),a[y](c),R.clearRect(0,0,q[s],q[o])}var h=U;return U++,q[s]=B*u,q[o]=j*u,{"name":e,"is":t,"imageList":a,"images":a[v],"priority":n,"id":h,"speed":r}}function yt(e,t){for(var n in e)n===t?this.image=e[t][_(0,e.images-1)]:this[n]=e[n];return this}function bt(){Q[y](gt("grass",T,7,2,[[1024,175,230,1.3,1,2],[50,200,245,1,1.3,1.5],[100,125,175,2,1,2]],32)),Q[y](gt("darkGrass",T,7,2,[[1024,150,205,1.3,1,2],[50,175,220,1,1.3,1.5],[100,100,150,2,1,2]],32)),Q[y](gt("road","speed",4,1,[[1024,0,0,1,1,1],[600,0,50,1,1,1]],32)),Q[y](gt("water","slow",3,3,[[1024,100,200,1.5,1.5,1],[600,100,200,1.5,1.5,1]],32))}function wt(){requestAnimationFrame(wt),Et()}function Et(){dt(),st(),vt(),Ht(),ot(),Ft()}function St(){n[h]("loading")[w].add("hidden")}function xt(){var e=[["base","special",1e3,100,15,25,255,0,0],["turret","basic",100,10,10,20,200,0,0]];for(var t=0;t<e[v];t++)Y[y](Tt(e[t][0],e[t][1],e[t][2],e[t][3],e[t][4],e[t][5],e[t][6],e[t][7],e[t][8]))}function Tt(e,t,n,r,i,u,a,f,l){var c=_(i,u),h=_(i,u)+Bt(c/1.5),p=_(i-3,u-3);q[s]=32,q[o]=32,R.clearRect(0,0,q[s],q[o]),At(0,0,c,h,p,a,l,f);var d=new Image;return d[N]=q[E](),q[s]=B*F,q[o]=j*F,{"name":e,"is":t,"cost":n,"health":r,"color":[a,l,f],"image":d,"width":c,"height":h,"depth":p}}function Nt(e,t,n){var i=M(Y,r,e)[0];At(F*t+(I-i[s]/2),F*n-i[o]+I,i[s],i[o],i.depth,i[L][0],i[L][1],i[L][2])}function Ct(e){return e-50<0?e:e-50}function kt(e,t,n,r,i,s,o){R.beginPath(),R.rect(e,t,n,r),R.fillStyle=b+i+","+s+","+o+")",R.fill()}function Lt(){var e=new Image;e[N]=q[E](),images[y](e)}function At(e,t,n,r,i,s,o,u){kt(e,t+i/2,n,r,s,u,o),kt(e,t,n,i,Ct(s),Ct(u),Ct(o))}function Ot(){for(var e=0;e<K[v];e++)for(var t=0;t<K[e][v];t++)if(K[e][t]===1)return{"x":t,"y":e};return!1}function Mt(){var e=[];G[y](Pt("Scoot","normal","FF0000",12,1,125,e))}function _t(e,t,n){for(var r=0;r<n[v];r++)if(n[r][0]===e&&n[r][1]===t)return!1;return!0}function Dt(){}function Pt(e,t,n,r,i,s,o){var u=_(0,3),a=0,f=0;do if(u===0||u===2)a=_(0,B-1),u===2&&(f=B-1);else if(u===1||u===3)f=_(0,j-1),u===1&&(a=j-1);while(!_t(a,f,o));o[y]([a,f]);var l=F/60*i,c=It.search(J,J[f][a],J[Ot().y][Ot().x]);return{"name":e,"type":t,"color":n,"size":r,"speed":l,"health":s,"targetX":c[0].x,"targetY":c[0].y,"path":c,"x":a,"y":f,"pixelX":jt(a,r),"pixelY":jt(f,r),"pathIndex":0}}function Ht(){for(i=0;i<G[v];i++){var e=G[i];R.beginPath(),R.fillStyle=e[L],R.fillRect(e.pixelX,e.pixelY,e.size,e.size),R.fill()}}function Bt(e){return O[g][m](e)}function jt(e,t){return Bt(e*F+I-t/2)}function Ft(){for(var e=0;e<G.length;e++){var t=G[e];if(t.pathIndex<t[T][v]){var n=t[T][t.pathIndex];t.x=H(t.pixelX+t.size/2,F),t.y=H(t.pixelY+t.size/2,F),t.targetX=n.x,t.targetY=n.y,Bt(t.pixelX)<jt(t.targetX,t.size)?t.pixelX+=t[A]:Bt(t.pixelY)<jt(t.targetY,t.size)?t.pixelY+=t[A]:Bt(t.pixelX)>jt(t.targetX,t.size)?t.pixelX-=t[A]:Bt(t.pixelY)>jt(t.targetY,t.size)&&(t.pixelY-=t[A]),Bt(t.pixelX)===jt(t.targetX,t.size)&&Bt(t.pixelY)===jt(t.targetY,t.size)&&t.pathIndex++}}}function qt(e){this.content=[],this.scoreFunction=e}function Rt(e){X+=e,zt()}function Ut(e){X-=e,zt()}function zt(){var e=n[d](".container");for(var t=0;t<e[v];t++){e[t][w].remove("expensive");var r=e[t][p](".cost").innerText.substring(1);parseInt(r,10)>X&&e[t][w].add("expensive")}}var n=e.document,r="name",s="width",o="height",u="<span",a="<div",f="</div>",l="</span>",c="innerHTML",h="getElementById",p="querySelector",d=p+"All",v="length",m="floor",g="Math",y="push",b="rgb(",w="classList",E="toDataURL",S=null,x="towers",T="path",N="src",C="cost",k="next",L="color",A="speed",O=e;(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t[v]&&!O.requestAnimationFrame;++n)O.requestAnimationFrame=O[t[n]+"RequestAnimationFrame"],O.cancelAnimationFrame=O[t[n]+"CancelAnimationFrame"]||O[t[n]+"CancelRequestAnimationFrame"];O.requestAnimationFrame||(O.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=O[g].max(0,16-(r-e)),s=O.setTimeout(function(){t(r+i)},i);return e=r+i,s}),O.cancelAnimationFrame||(O.cancelAnimationFrame=function(e){clearTimeout(e)})})(),O.addEventListener("DOMContentLoaded",function(){D(),bt(),xt(),ct();var e=pt(B,j);J=e[0],K=e[1],Mt(),Rt(500),wt(),St()});var B=20,j=20,F=32,I=F/2,q,R,U=0,z={"x":0,"y":0},W="black",X=0,V=S,J=[],K=[],Q=[],G=[],Y=[];O.addEventListener("DOMContentLoaded",function(){rt(q,"mousemove",nt),rt(q,"click",tt)},!0),yt.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},yt.prototype.isWall=function(){return this.type===0};var It={"init":function(e){for(var t=0,n=e[v];t<n;t++)for(var r=0,i=e[t][v];r<i;r++){var s=e[t][r];s.f=0,s.g=0,s.h=0,s[C]=s[A],s.visited=!1,s.closed=!1,s.parent=S}},"heap":function(){return new qt(function(e){return e.f})},"search":function(e,t,n,r,i){It.init(e),i=i||It.manhattan,r=!!r;var s=It.heap();s[y](t);while(s.size()>0){var o=s.pop();if(o===n){var u=o,a=[];while(u.parent)a[y](u),u=u.parent;return a.reverse()}o.closed=!0;var f=It.neighbors(e,o,r);for(var l=0,c=f[v];l<c;l++){var h=f[l];if(h.closed||h.isWall())continue;var p=o.g+h[C],d=h.visited;if(!d||p<h.g)h.visited=!0,h.parent=o,h.h=h.h||i(h.pos,n.pos),h.g=p,h.f=h.g+h.h,d?s.rescoreElement(h):s[y](h)}}return[]},"manhattan":function(e,t){var n=O[g].abs(t.x-e.x),r=O[g].abs(t.y-e.y);return n+r},"neighbors":function(e,t,n){var r=[],i=t.x,s=t.y;return e[i-1]&&e[i-1][s]&&r[y](e[i-1][s]),e[i+1]&&e[i+1][s]&&r[y](e[i+1][s]),e[i]&&e[i][s-1]&&r[y](e[i][s-1]),e[i]&&e[i][s+1]&&r[y](e[i][s+1]),n&&(e[i-1]&&e[i-1][s-1]&&r[y](e[i-1][s-1]),e[i+1]&&e[i+1][s-1]&&r[y](e[i+1][s-1]),e[i-1]&&e[i-1][s+1]&&r[y](e[i-1][s+1]),e[i+1]&&e[i+1][s+1]&&r[y](e[i+1][s+1])),r}};qt.prototype={"push":function(e){this.content[y](e),this.sinkDown(this.content[v]-1)},"pop":function(){var e=this.content[0],t=this.content.pop();return this.content[v]>0&&(this.content[0]=t,this.bubbleUp(0)),e},"remove":function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content[v]-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},"size":function(){return this.content[v]},"rescoreElement":function(e){this.sinkDown(this.content.indexOf(e))},"sinkDown":function(e){var t=this.content[e];while(e>0){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},"bubbleUp":function(e){var t=this.content[v],n=this.content[e],r=this.scoreFunction(n);for(;;){var i=e+1<<1,s=i-1,o=S;if(s<t){var u=this.content[s],a=this.scoreFunction(u);a<r&&(o=s)}if(i<t){var f=this.content[i],l=this.scoreFunction(f);l<(o===S?r:a)&&(o=i)}if(o===S)break;this.content[e]=this.content[o],this.content[o]=n,e=o}}};var X=0})(window)