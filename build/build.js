(function(e,t){function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}function i(){l=n.getElementById("canvas"),l.width=u*f,l.height=a*f,c=l.getContext("2d")}function s(){var e=0;for(var t=0;t<h.length;t++)e+=h[t].priority;var n=r(0,e-1);for(var t=0;t<h.length;t++){if(n<h[t].priority)return t;n-=h[t].priority}return!1}function o(e,t){var n=e%t;return(e-n)/t}function b(){var e=m.x*32,t=m.y*32,n=e+32,r=t+32;c.strokeStyle=g,c.lineWidth=2,c.strokeRect(e,t,32,32),c.strokeStyle="#FFF",c.strokeRect(e-2,t-2,36,36)}function w(){var e=["canBuild","isBuilding","building","mouse"],t="<li>",r="</li>",i="<pre>",s="</pre>",o=[];for(var u=0;u<e.length;u++)typeof this[e[u]]=="function"?o.push(e[u]+": "+i+JSON.stringify(this[e[u]]())+s):o.push(e[u]+": "+i+JSON.stringify(this[e[u]])+s);n.getElementById("stats")&&(n.getElementById("stats").innerHTML="<ul>"+t+o.join(r+t)+r+"</ul>")}function E(){return x()?!0:!1}function S(e,t){var n=[];for(var r in y)y[r][e]===t&&n.push(y[r]);return n}function x(){return S("name","scorpion")[0]}function T(){var e=p[m.y][m.x];return d[m.y][m.x]!==0?null:E()?x().is==="terrain"?!0:e.is==="path"?!0:x().is==="trap"&&e.is==="fast"?!0:!1:!0}function N(e,t){var n=[],r=[];for(var i=0;i<t;i++){n[i]=n[i]||[],r[i]=r[i]||[];for(var o=0;o<e;o++){var u=s(),a=h[u];n[i][o]=new A(h[u],"imageList"),r[i][o]=0}}return[n,r]}function C(){for(var e=0;e<p.length;e++)for(var t=0;t<p[e].length;t++)c.drawImage(p[e][t].image,t*32,e*32)}function k(e,t,n,i,s,o,u){var a,f,l=[],h=[];for(var p=0;p<e;p++)l.push(r(0,t-1,e)),h.push(r(0,t-1,e));for(a=0;a<e;a++)f=r(n,i),c.fillStyle="rgb("+Math.floor(f/s)+","+Math.floor(f/o)+","+Math.floor(f/u)+")",c.fillRect(l[a],h[a],1,1)}function L(e,t,n,i,s){var o=[];for(var u=0;u<3;u++){num=r(i[0][1],i[0][2]),c.fillStyle="rgb("+Math.floor(num/i[0][3])+","+Math.floor(num/i[0][4])+","+Math.floor(num/i[0][5])+")",c.fillRect(0,0,s,s);for(var a=0;a<i.length;a++)k(i[a][0],s,i[a][1],i[a][2],i[a][3],i[a][4],i[a][5]);var f=new Image;f.src=l.toDataURL(),o.push(f),c.clearRect(0,0,l.width,l.height)}var h=v;return v++,{"name":e,"is":t,"imageList":o,"images":o.length,"priority":n,"id":h}}function A(e,t){for(var n in e)n===t?this.image=e[t][r(0,e.images-1)]:this[n]=e[n];return this}function O(){h.push(L("grass","path",7,[[1024,175,230,1.3,1,2],[50,200,245,1,1.3,1.5],[100,125,175,2,1,2]],32)),h.push(L("darkGrass","path",7,[[1024,150,205,1.3,1,2],[50,175,220,1,1.3,1.5],[100,100,150,2,1,2]],32)),h.push(L("road","speed",4,[[1024,0,0,1,1,1],[600,0,50,1,1,1]],32)),h.push(L("water","slow",3,[[1024,100,200,1.5,1.5,1],[600,100,200,1.5,1.5,1]],32))}function M(){requestAnimationFrame(M),_()}function _(){C(),b(),w()}function D(){n.getElementById("loading").classList.add("hidden")}var n=e.document;(function(){var t=0,n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,r){var i=(new Date).getTime(),s=Math.max(0,16-(i-t)),o=e.setTimeout(function(){n(i+s)},s);return t=i+s,o}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})})(),e.addEventListener("DOMContentLoaded",function(){i(),O();var e=N(u,a);p=e[0],d=e[1],M(),D()},!0);var u=20,a=20,f=32,l,c,h=[],p,d,v=0,m={"x":0,"y":0},g="black",y={"images/drain.png":{"type":"trap","name":"drain","src":"images/drain.png","stats":{"health":"","cost":"10"}},"images/scorpion.png":{"type":"structure","name":"scorpion","src":"images/scorpion.png","stats":{"health":"100","cost":"100"}}};e.addEventListener("DOMContentLoaded",function(){l.addEventListener("mousemove",function(e){m.x=e.pageX-l.offsetLeft,m.y=e.pageY-l.offsetTop,m.x=o(m.x,f),m.y=o(m.y,f),g="black",T()&&E()?g="green":T()===null?g="blue":T()||(g="red")},!0)},!0)})(window)