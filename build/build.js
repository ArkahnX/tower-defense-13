(function(e,t){function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}function s(){c=n.getElementById("canvas"),c.width=a*l,c.height=f*l,h=c.getContext("2d")}function o(){var e=0;for(var t=0;t<p.length;t++)e+=p[t].priority;var n=r(0,e-1);for(var t=0;t<p.length;t++){if(n<p[t].priority)return t;n-=p[t].priority}return!1}function u(e,t){var n=e%t;return(e-n)/t}function x(){var e=g.x*32,t=g.y*32,n=e+32,r=t+32;h.strokeStyle=w,h.lineWidth=2,h.strokeRect(e,t,32,32),h.strokeStyle="#FFF",h.strokeRect(e-2,t-2,36,36)}function T(){var e=["canBuild","isBuilding","building","mouse"],t="<li>",r="</li>",i="<pre>",s="</pre>",o=[];for(var u=0;u<e.length;u++)typeof this[e[u]]=="function"?o.push(e[u]+": "+i+JSON.stringify(this[e[u]]())+s):o.push(e[u]+": "+i+JSON.stringify(this[e[u]])+s);n.getElementById("stats")&&(n.getElementById("stats").innerHTML="<ul>"+t+o.join(r+t)+r+"</ul>")}function N(){return k()?!0:!1}function C(e,t,n){var r=[];for(var i in e)e[i][t]===n&&r.push(e[i]);return r}function k(){return C(S,"name","scorpion")[0]}function L(){var e=d[g.y][g.x];return v[g.y][g.x]!==0?null:N()?k().is==="terrain"?!0:e.is==="path"?!0:k().is==="trap"&&e.is==="fast"?!0:!1:!0}function A(){n.getElementById("towers").innerHTML="<ul></ul>"}function O(){n.getElementById("towers").children[0].children.length>0&&A();var e=[];for(var t=0;t<b.length;t++){var r=b[t],i="<span>"+r.name+"</span>",s="<span class='cost'>$"+r.cost+"</span>",o="<img src='"+r.image.src+"' title='"+r.type+": "+r.name+" ($"+r.cost+")"+"'>",u="<div class='container'>"+o+i+s+"</div>";e.push("<li>"+u+"</li>")}n.getElementById("towers").children[0].innerHTML=e.join("")}function M(){menu.children().length>0&&A();for(var e in S){var t=S[e],n=$("<div class='container'></div>"),r=$("<span>"+t.name+"</span>"),i=$("<span class='cost'>$"+t.stats.cost+"</span>"),s=new Image;n.append(s),n.append(r),n.append(i),s.src=t.src,s.title=t.type+": "+t.name+" ($"+t.stats.cost+")",menu.append(n),applyClicks()}var o=$("#canvas").position().left,u=$("#canvas").position().top;target.css({"left":o-3,"top":u-3})}function _(e,t){var n=[],i=[];for(var s=0;s<t;s++){n[s]=n[s]||[],i[s]=i[s]||[];for(var u=0;u<e;u++){var a=o(),f=p[a];f.x=u,f.y=s,f.pos={"x":u,"y":s},n[s][u]=new j(p[a],"imageList"),i[s][u]=0}}var l=r(e/2-1,t/2+1);return i[l][l]=1,[n,i]}function D(){for(var e=0;e<d.length;e++)for(var t=0;t<d[e].length;t++)h.drawImage(d[e][t].image,t*32,e*32)}function P(){for(var e=0;e<d.length;e++)for(var t=0;t<d[e].length;t++)v[e][t]>0&&W(b[v[e][t]-1].name,t,e)}function H(e,t,n,i,s,o,u){var a,f,l=[],c=[];for(var p=0;p<e;p++)l.push(r(0,t-1,e)),c.push(r(0,t-1,e));for(a=0;a<e;a++)f=r(n,i),h.fillStyle="rgb("+Math.floor(f/s)+","+Math.floor(f/o)+","+Math.floor(f/u)+")",h.fillRect(l[a],c[a],1,1)}function B(e,t,n,i,s,o){var u=[];c.width=32,c.height=32;for(var l=0;l<3;l++){num=r(s[0][1],s[0][2]),h.fillStyle="rgb("+Math.floor(num/s[0][3])+","+Math.floor(num/s[0][4])+","+Math.floor(num/s[0][5])+")",h.fillRect(0,0,o,o);for(var p=0;p<s.length;p++)H(s[p][0],o,s[p][1],s[p][2],s[p][3],s[p][4],s[p][5]);var d=new Image;d.src=c.toDataURL(),u.push(d),h.clearRect(0,0,c.width,c.height)}var v=m;return m++,c.width=a*o,c.height=f*o,{"name":e,"is":t,"imageList":u,"images":u.length,"priority":n,"id":v,"speed":i}}function j(e,t){for(var n in e)n===t?this.image=e[t][r(0,e.images-1)]:this[n]=e[n];return this}function F(){p.push(B("grass","path",7,2,[[1024,175,230,1.3,1,2],[50,200,245,1,1.3,1.5],[100,125,175,2,1,2]],32)),p.push(B("darkGrass","path",7,2,[[1024,150,205,1.3,1,2],[50,175,220,1,1.3,1.5],[100,100,150,2,1,2]],32)),p.push(B("road","speed",4,1,[[1024,0,0,1,1,1],[600,0,50,1,1,1]],32)),p.push(B("water","slow",3,3,[[1024,100,200,1.5,1.5,1],[600,100,200,1.5,1.5,1]],32))}function I(){requestAnimationFrame(I),q()}function q(){D(),x(),P(),Y(),T()}function R(){n.getElementById("loading").classList.add("hidden")}function U(){var e=[["base","special",1e3,100,15,25,255,0,0],["turret","basic",100,10,10,20,200,0,0]];for(var t=0;t<e.length;t++)b.push(z(e[t][0],e[t][1],e[t][2],e[t][3],e[t][4],e[t][5],e[t][6],e[t][7],e[t][8]))}function z(e,t,n,i,s,o,u,p,d){var v=r(s,o),m=r(s,o)+Math.floor(v/1.5),g=r(s-3,o-3);c.width=32,c.height=32,h.clearRect(0,0,c.width,c.height),K(0,0,v,m,g,u,d,p);var y=new Image;return y.src=c.toDataURL(),c.width=a*l,c.height=f*l,{"name":e,"is":t,"cost":n,"health":i,"color":[u,d,p],"image":y,"width":v,"height":m,"depth":g}}function W(e,t,n){var r=C(b,"name",e)[0];K(l*t+(l/2-r.width/2),l*n-r.height+l/2,r.width,r.height,r.depth,r.color[0],r.color[1],r.color[2])}function X(e){return e-50<0?e:e-50}function V(e,t,n,r,i,s,o){h.beginPath(),h.rect(e,t,n,r),h.fillStyle="rgb("+i+","+s+","+o+")",h.fill()}function J(){var e=new Image;e.src=c.toDataURL(),images.push(e)}function K(e,t,n,r,i,s,o,u){V(e,t+i/2,n,r,s,u,o),V(e,t,n,i,X(s),X(u),X(o))}function Q(){y.push(G("Scoot","normal","FF0000",12,13,125)),y.push(G("Solly","normal","0FF000",18,8,200)),y.push(G("Pyro","normal","00FF00",16,10,175)),y.push(G("Demo","normal","000FF0",16,9,125)),y.push(G("Hoovey","normal","0000FF",20,7,300)),y.push(G("Engie","normal","FFFF00",16,10,125)),y.push(G("Medic","normal","0FFFF0",14,11,150)),y.push(G("Sniper","normal","00FFFF",12,10,125)),y.push(G("Spah","normal","FFFFFF",10,10,125))}function G(e,t,n,r,i,s){var o=Math.ceil(4*Math.random()),u=0,a=0;if(o===1||o===3)u=Math.random()*32*19.5,o===3&&(a=640-r);if(o===2||o===4)a=Math.random()*32*19.5,o===2&&(u=640-r);return{"name":e,"type":t,"color":n,"size":r,"speed":i,"health":s,"x":u,"y":a}}function Y(){for(i=0;i<y.length;i++)mook=y[i],h.beginPath(),h.fillStyle=mook.color,h.fillRect(mook.x,mook.y,mook.size,mook.size),h.fill()}var n=e.document;(function(){var t=0,n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,r){var i=(new Date).getTime(),s=Math.max(0,16-(i-t)),o=e.setTimeout(function(){n(i+s)},s);return t=i+s,o}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})})(),e.addEventListener("DOMContentLoaded",function(){s(),F(),Q(),U(),O();var e=_(a,f);d=e[0],v=e[1],I(),R()});var a=20,f=20,l=32,c,h,p=[],d,v,m=0,g={"x":0,"y":0},y=[],b=[],w="black",E={"OPEN":1,"WALL":0},S={"images/drain.png":{"type":"trap","name":"drain","src":"images/drain.png","stats":{"health":"","cost":"10"}},"images/scorpion.png":{"type":"structure","name":"scorpion","src":"images/scorpion.png","stats":{"health":"100","cost":"100"}}};e.addEventListener("DOMContentLoaded",function(){c.addEventListener("mousemove",function(e){g.x=e.pageX-c.offsetLeft,g.y=e.pageY-c.offsetTop,g.x=u(g.x,l),g.y=u(g.y,l),w="black",L()&&N()?w="green":L()===null?w="blue":L()||(w="red")},!0),c.addEventListener("click",function(e){},!0)},!0),j.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},j.prototype.isWall=function(){return this.type==E.WALL}})(window)