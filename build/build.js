(function(e,t){function r(e,t){return Math.floor(Math.random()*(t-e+1))+e}function s(){c=n.getElementById("canvas"),c.width=a*l,c.height=f*l,p=c.getContext("2d")}function o(){var e=0;for(var t=0;t<d.length;t++)e+=d[t].priority;var n=r(0,e-1);for(var t=0;t<d.length;t++){if(n<d[t].priority)return t;n-=d[t].priority}return!1}function u(e,t){var n=e%t;return(e-n)/t}function T(){var e=y.x*32,t=y.y*32,n=e+32,r=t+32;p.strokeStyle=S,p.lineWidth=2,p.strokeRect(e,t,32,32),p.strokeStyle="#FFF",p.strokeRect(e-2,t-2,36,36)}function N(){var e=["canBuild","isBuilding","building","mouse"],t="<li>",r="</li>",i="<pre>",s="</pre>",o=[];for(var u=0;u<e.length;u++)typeof this[e[u]]=="function"?o.push(e[u]+": "+i+JSON.stringify(this[e[u]]())+s):o.push(e[u]+": "+i+JSON.stringify(this[e[u]])+s);n.getElementById("stats")&&(n.getElementById("stats").innerHTML="<ul>"+t+o.join(r+t)+r+"</ul>")}function C(){return L()?!0:!1}function k(e,t,n){var r=[];for(var i in e)e[i][t]===n&&r.push(e[i]);return r}function L(){return k("name","scorpion")[0]}function A(){var e=v[y.y][y.x];return m[y.y][y.x]!==0?null:C()?L().is==="terrain"?!0:e.is==="path"?!0:L().is==="trap"&&e.is==="fast"?!0:!1:!0}function O(){}function M(e,t){var n=[],i=[];for(var s=0;s<t;s++){n[s]=n[s]||[],i[s]=i[s]||[];for(var u=0;u<e;u++){var a=o(),f=d[a];n[s][u]=new H(d[a],"imageList"),i[s][u]=0}}var l=r(e/2,t/2);return i[l][l]=1,[n,i]}function _(){for(var e=0;e<v.length;e++)for(var t=0;t<v[e].length;t++)p.drawImage(v[e][t].image,t*32,e*32),m[e][t]>0}function D(e,t,n,i,s,o,u){var a,f,l=[],c=[];for(var h=0;h<e;h++)l.push(r(0,t-1,e)),c.push(r(0,t-1,e));for(a=0;a<e;a++)f=r(n,i),p.fillStyle="rgb("+Math.floor(f/s)+","+Math.floor(f/o)+","+Math.floor(f/u)+")",p.fillRect(l[a],c[a],1,1)}function P(e,t,n,i,s){var o=[];for(var u=0;u<3;u++){num=r(i[0][1],i[0][2]),p.fillStyle="rgb("+Math.floor(num/i[0][3])+","+Math.floor(num/i[0][4])+","+Math.floor(num/i[0][5])+")",p.fillRect(0,0,s,s);for(var a=0;a<i.length;a++)D(i[a][0],s,i[a][1],i[a][2],i[a][3],i[a][4],i[a][5]);var f=new Image;f.src=c.toDataURL(),o.push(f),p.clearRect(0,0,c.width,c.height)}var l=g;return g++,{"name":e,"is":t,"imageList":o,"images":o.length,"priority":n,"id":l}}function H(e,t){for(var n in e)n===t?this.image=e[t][r(0,e.images-1)]:this[n]=e[n];return this}function B(){d.push(P("grass","path",7,[[1024,175,230,1.3,1,2],[50,200,245,1,1.3,1.5],[100,125,175,2,1,2]],32)),d.push(P("darkGrass","path",7,[[1024,150,205,1.3,1,2],[50,175,220,1,1.3,1.5],[100,100,150,2,1,2]],32)),d.push(P("road","speed",4,[[1024,0,0,1,1,1],[600,0,50,1,1,1]],32)),d.push(P("water","slow",3,[[1024,100,200,1.5,1.5,1],[600,100,200,1.5,1.5,1]],32))}function j(){requestAnimationFrame(j),F()}function F(){_(),J(),T(),N()}function I(){n.getElementById("loading").classList.add("hidden")}function q(){var e=[["turret","basic",255,0,0]];for(var t=0;t<e.length;t++)E.push(R(e[t][0],e[t][1],e[t][2],e[t][3],e[t][4]))}function R(e,t,n,i,s){var o=r(10,20),u=r(10,20)+Math.floor(o/1.5),a=r(7,15);return{"name":e,"is":t,"color":[n,i,s],"width":o,"height":u,"depth":a}}function U(e,t,n){var r=k(E,"name",e)[0];X(l*t+(l/2-r.width/2),l*n-f+l/2,r.width,r.height,r.color[0],r.color[1],r.color[2])}function z(e){return e-50<0?e:e-50}function W(e,t,n,r,i,s,o){p.beginPath(),p.rect(e,t,n,r),p.fillStyle="rgb("+i+","+s+","+o+")",p.fill()}function X(e,t,n,r,i,s,o,u){W(e,t,w,h+i/2,s,u,o),W(e,t,w,h,z(s),z(u),z(o))}function V(){b.push($("Scoot","normal","FF0000",12,13,125)),b.push($("Solly","normal","0FF000",12,13,125)),b.push($("Pyro","normal","00FF00",16,10,175)),b.push($("Demo","normal","00FF00",12,13,125)),b.push($("Hoovey","normal","0000FF",20,7,300)),b.push($("Engie","normal","00FF00",12,13,125)),b.push($("Medic","normal","00FF00",12,13,125)),b.push($("Sniper","normal","00FF00",12,13,125)),b.push($("Spah","normal","00FF00",12,13,125))}function $(e,t,n,r,i,s){var o=Math.ceil(4*Math.random()),u=0,a=0;if(o===1||o===3)u=Math.random()*32*19.5,o===3&&(a=640-r);if(o===2||o===4)a=Math.random()*32*19.5,o===2&&(u=640-r);return{"name":e,"type":t,"color":n,"size":r,"speed":i,"health":s,"x":u,"y":a}}function J(){for(i=0;i<b.length;i++)mook=b[i],p.fillStyle=mook.color,p.fillRect(mook.x,mook.y,mook.size,mook.size)}var n=e.document;(function(){var t=0,n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,r){var i=(new Date).getTime(),s=Math.max(0,16-(i-t)),o=e.setTimeout(function(){n(i+s)},s);return t=i+s,o}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})})(),e.addEventListener("DOMContentLoaded",function(){s(),B(),V(),q();var e=M(a,f);v=e[0],m=e[1],j(),I()},!0);var a=20,f=20,l=32,c,p,d=[],v,m,g=0,y={"x":0,"y":0},b=[],E=[],S="black",x={"images/drain.png":{"type":"trap","name":"drain","src":"images/drain.png","stats":{"health":"","cost":"10"}},"images/scorpion.png":{"type":"structure","name":"scorpion","src":"images/scorpion.png","stats":{"health":"100","cost":"100"}}};e.addEventListener("DOMContentLoaded",function(){c.addEventListener("mousemove",function(e){y.x=e.pageX-c.offsetLeft,y.y=e.pageY-c.offsetTop,y.x=u(y.x,l),y.y=u(y.y,l),S="black",A()&&C()?S="green":A()===null?S="blue":A()||(S="red")},!0)},!0)})(window)