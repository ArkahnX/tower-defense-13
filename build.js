function random(e,t){return Math.floor(Math.random()*(t-e+1))+e}function unique(e,t,n){var r=[],i=[];while(i.length<n){var s=random(e,t);while(r.indexOf(s)>-1)s=random(e,t);i.push(s),r.push(s),r.length>=t&&(r.length=0)}return i}function init(){canvas=document.getElementById("canvas"),canvas.width=width*tileSize,canvas.height=height*tileSize,context=canvas.getContext("2d")}function makeMap(e,t){var n=[],r=[];for(var i=0;i<t;i++){n[i]=n[i]||[],r[i]=r[i]||[];for(var s=0;s<e;s++)n[i][s]=random(0,tiles.length-1),r[i][s]=0}return[n,r]}function drawMap(){for(var e=0;e<map.length;e++)for(var t=0;t<map[e].length;t++)context.drawImage(tiles[map[e][t]],t*32,e*32)}function makeTilePart(e,t,n,r){var i,s,o=unique(0,t-1,e),u=unique(0,t-1,e);for(i=0;i<e;i++)s=random(n[0],n[1]),context.fillStyle="rgb("+Math.floor(s/r[0])+","+Math.floor(s/r[1])+","+Math.floor(s/r[2])+")",context.fillRect(o[i],u[i],1,1)}function makeTile(e,t){context.clearRect(0,0,canvas.width,canvas.height),num=random(e[0][1][0],e[0][1][1]),context.fillStyle="rgb("+Math.floor(num/e[0][2][0])+","+Math.floor(num/e[0][2][1])+","+Math.floor(num/e[0][2][2])+")",context.fillRect(0,0,t,t);for(var n=0;n<e.length;n++)makeTilePart(e[n][0],t,e[n][1],e[n][2]);var r=new Image;return r.src=canvas.toDataURL(),r}function makeSprites(){for(var e=0;e<5;e++)tiles.push(makeTile([[1024,[175,230],[1.3,1,2]],[50,[200,245],[1,1.3,1.5]],[100,[125,175],[2,1,2]]],32));for(var e=0;e<3;e++)tiles.push(makeTile([[1024,[0,0],[1,1,1]],[600,[0,50],[1,1,1]]],32));for(var e=0;e<2;e++)tiles.push(makeTile([[1024,[100,200],[1.5,1.5,1]],[600,[100,200],[1.5,1.5,1]]],32))}function animate(){requestAnimationFrame(animate),draw()}function draw(){drawMap()}(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})})();var width=20,height=20,tileSize=32,canvas,context,tiles=[],map,obstacles;window.addEventListener("DOMContentLoaded",function(){init(),makeSprites();var e=makeMap(width,height);map=e[0],obstacles=e[1],animate()},!0)